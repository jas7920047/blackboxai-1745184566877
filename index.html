<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Step-by-Step Integration and Differentiation of f(x) with Set Theory & Combinatorics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col items-center p-6">
  <header class="mb-8 text-center">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">Step-by-Step Integration and Differentiation of f(x)</h1>
    <p class="text-gray-600 max-w-xl mx-auto">Enter a function f(x) to see its step-by-step integration or differentiation process along with the graph.</p>
  </header>

  <main class="w-full max-w-3xl bg-white rounded-lg shadow-md p-6">
    <form id="calculationForm" class="mb-6">
      <label for="functionInput" class="block text-gray-700 font-semibold mb-2">Function f(x):</label>
      <input
        type="text"
        id="functionInput"
        name="functionInput"
        placeholder="e.g. 3x^2 + 2x - 5 or 4sin(x) - cos(x)"
        class="w-full border border-gray-300 rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        required
      />
      <div class="mt-4 flex space-x-4">
        <button
          type="submit"
          name="operation"
          value="integrate"
          class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-md hover:bg-blue-700 transition flex items-center justify-center flex-1"
        >
          <i class="fas fa-calculator mr-2"></i> Integrate
        </button>
        <button
          type="submit"
          name="operation"
          value="differentiate"
          class="bg-green-600 text-white font-semibold px-6 py-3 rounded-md hover:bg-green-700 transition flex items-center justify-center flex-1"
        >
          <i class="fas fa-chart-line mr-2"></i> Differentiate
        </button>
      </div>
    </form>

    <section id="resultSection" class="text-gray-800">
      <h2 class="text-2xl font-semibold mb-4">Steps:</h2>
      <div id="stepsContainer" class="space-y-4"></div>
    </section>
  </main>

  <canvas id="functionGraph" class="max-w-3xl w-full mt-6 rounded-lg shadow-md bg-white" width="600" height="300"></canvas>

  <div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-6 mt-8">
    <h2 class="text-3xl font-bold mb-4 text-center text-gray-800">Set Theory & Combinatorics</h2>
    <div class="space-y-6">
      <div>
        <h3 class="text-xl font-semibold mb-2">Set Operations</h3>
        <label for="setA" class="block font-medium mb-1">Set A (comma separated):</label>
        <input type="text" id="setA" placeholder="e.g. 1,2,3,4" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="setB" class="block font-medium mb-1">Set B (comma separated):</label>
        <input type="text" id="setB" placeholder="e.g. 3,4,5,6" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <div class="flex space-x-4 mb-2">
          <button type="button" id="unionBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition flex-1">Union</button>
          <button type="button" id="intersectionBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition flex-1">Intersection</button>
          <button type="button" id="cardinalityBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition flex-1">Cardinality</button>
        </div>
        <div id="setResult" class="text-gray-800 font-mono whitespace-pre-wrap"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Permutations & Combinations</h3>
        <label for="nValue" class="block font-medium mb-1">n (total items):</label>
        <input type="number" id="nValue" min="0" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="rValue" class="block font-medium mb-1">r (items chosen):</label>
        <input type="number" id="rValue" min="0" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <div class="flex space-x-4 mb-2">
          <button type="button" id="permutationBtn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition flex-1">Permutations</button>
          <button type="button" id="combinationBtn" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700 transition flex-1">Combinations</button>
        </div>
        <div id="permCombResult" class="text-gray-800 font-mono whitespace-pre-wrap"></div>
      </div>
    </div>
  </div>

  <div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-6 mt-8">
    <h2 class="text-3xl font-bold mb-4 text-center text-gray-800">Probability & Statistics</h2>
    <div class="space-y-6">
      <div>
        <h3 class="text-xl font-semibold mb-2">Probability Basics</h3>
        <label for="probEventA" class="block font-medium mb-1">P(A) (Probability of event A):</label>
        <input type="number" id="probEventA" min="0" max="1" step="0.01" placeholder="e.g. 0.5" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="probEventB" class="block font-medium mb-1">P(B) (Probability of event B):</label>
        <input type="number" id="probEventB" min="0" max="1" step="0.01" placeholder="e.g. 0.3" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="probEventAB" class="block font-medium mb-1">P(A ∩ B) (Probability of both A and B):</label>
        <input type="number" id="probEventAB" min="0" max="1" step="0.01" placeholder="e.g. 0.1" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcProbBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition w-full">Calculate P(A ∪ B)</button>
        <div id="probResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Averages & Central Tendencies</h3>
        <label for="dataSet" class="block font-medium mb-1">Data Set (comma separated numbers):</label>
        <input type="text" id="dataSet" placeholder="e.g. 1,2,2,3,4,5" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcAvgBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition w-full">Calculate Mean, Median, Mode</button>
        <div id="avgResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Dispersion</h3>
        <button type="button" id="calcDispersionBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition w-full">Calculate Variance & Standard Deviation</button>
        <div id="dispersionResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>
    </div>
  </div>

  <div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-6 mt-8">
    <h2 class="text-3xl font-bold mb-4 text-center text-gray-800">Coordinate Geometry</h2>
    <div class="space-y-6">
      <div>
        <h3 class="text-xl font-semibold mb-2">Cartesian Coordinates</h3>
        <label for="pointX" class="block font-medium mb-1">Point X:</label>
        <input type="number" id="pointX" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="pointY" class="block font-medium mb-1">Point Y:</label>
        <input type="number" id="pointY" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcDistanceBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition w-full">Calculate Distance from Origin</button>
        <div id="distanceResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Line Equation</h3>
        <label for="lineX1" class="block font-medium mb-1">Point 1 X:</label>
        <input type="number" id="lineX1" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="lineY1" class="block font-medium mb-1">Point 1 Y:</label>
        <input type="number" id="lineY1" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="lineX2" class="block font-medium mb-1">Point 2 X:</label>
        <input type="number" id="lineX2" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="lineY2" class="block font-medium mb-1">Point 2 Y:</label>
        <input type="number" id="lineY2" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcLineBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition w-full">Calculate Line Equation</button>
        <div id="lineResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Circle</h3>
        <label for="circleH" class="block font-medium mb-1">Center X (h):</label>
        <input type="number" id="circleH" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="circleK" class="block font-medium mb-1">Center Y (k):</label>
        <input type="number" id="circleK" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="circleR" class="block font-medium mb-1">Radius (r):</label>
        <input type="number" id="circleR" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcCircleBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition w-full">Calculate Circle Equation</button>
        <div id="circleResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Parabola</h3>
        <label for="parabolaA" class="block font-medium mb-1">Coefficient a:</label>
        <input type="number" id="parabolaA" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="parabolaH" class="block font-medium mb-1">Vertex h:</label>
        <input type="number" id="parabolaH" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="parabolaK" class="block font-medium mb-1">Vertex k:</label>
        <input type="number" id="parabolaK" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcParabolaBtn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition w-full">Calculate Parabola Equation</button>
        <div id="parabolaResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Ellipse</h3>
        <label for="ellipseH" class="block font-medium mb-1">Center h:</label>
        <input type="number" id="ellipseH" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="ellipseK" class="block font-medium mb-1">Center k:</label>
        <input type="number" id="ellipseK" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="ellipseA" class="block font-medium mb-1">Semi-major axis a:</label>
        <input type="number" id="ellipseA" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="ellipseB" class="block font-medium mb-1">Semi-minor axis b:</label>
        <input type="number" id="ellipseB" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcEllipseBtn" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700 transition w-full">Calculate Ellipse Equation</button>
        <div id="ellipseResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Hyperbola</h3>
        <label for="hyperbolaH" class="block font-medium mb-1">Center h:</label>
        <input type="number" id="hyperbolaH" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="hyperbolaK" class="block font-medium mb-1">Center k:</label>
        <input type="number" id="hyperbolaK" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="hyperbolaA" class="block font-medium mb-1">Semi-major axis a:</label>
        <input type="number" id="hyperbolaA" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="hyperbolaB" class="block font-medium mb-1">Semi-minor axis b:</label>
        <input type="number" id="hyperbolaB" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcHyperbolaBtn" class="bg-teal-600 text-white px-4 py-2 rounded hover:bg-teal-700 transition w-full">Calculate Hyperbola Equation</button>
        <div id="hyperbolaResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>
    </div>
  </div>

  <div class="w-full max-w-3xl bg-white rounded-lg shadow-md p-6 mt-8">
    <h2 class="text-3xl font-bold mb-4 text-center text-gray-800">Advanced Calculus</h2>
    <div class="space-y-6">
      <div>
        <h3 class="text-xl font-semibold mb-2">Limits & Continuity</h3>
        <label for="limitExpr" class="block font-medium mb-1">Function f(x):</label>
        <input type="text" id="limitExpr" placeholder="e.g. (x^2 - 1)/(x - 1)" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="limitAt" class="block font-medium mb-1">Limit as x approaches:</label>
        <input type="number" id="limitAt" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcLimitBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition w-full">Calculate Limit</button>
        <div id="limitResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Tangents & Normals</h3>
        <label for="tangentExpr" class="block font-medium mb-1">Function f(x):</label>
        <input type="text" id="tangentExpr" placeholder="e.g. x^2" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="tangentAt" class="block font-medium mb-1">At x =</label>
        <input type="number" id="tangentAt" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcTangentBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition w-full">Calculate Tangent & Normal</button>
        <div id="tangentResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Maxima & Minima</h3>
        <label for="maxMinExpr" class="block font-medium mb-1">Function f(x):</label>
        <input type="text" id="maxMinExpr" placeholder="e.g. x^3 - 3x^2 + 2" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcMaxMinBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition w-full">Calculate Maxima & Minima</button>
        <div id="maxMinResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>

      <div>
        <h3 class="text-xl font-semibold mb-2">Definite Integrals & Applications</h3>
        <label for="defIntegralExpr" class="block font-medium mb-1">Function f(x):</label>
        <input type="text" id="defIntegralExpr" placeholder="e.g. x^2" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="defIntegralA" class="block font-medium mb-1">Lower limit a:</label>
        <input type="number" id="defIntegralA" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <label for="defIntegralB" class="block font-medium mb-1">Upper limit b:</label>
        <input type="number" id="defIntegralB" step="any" class="w-full border border-gray-300 rounded-md p-2 mb-2" />
        <button type="button" id="calcDefIntegralBtn" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700 transition w-full">Calculate Definite Integral</button>
        <div id="defIntegralResult" class="text-gray-800 font-mono whitespace-pre-wrap mt-2"></div>
      </div>
    </div>
  </div>

    document.addEventListener('DOMContentLoaded', () => {
      // Step-by-step integration and differentiation functions

      // Parse function string into terms (simple parser for polynomials and basic trig)
      function parseFunction(funcStr) {
        // Split by + and - but keep the sign with the term
        const terms = funcStr.match(/[+-]?[^+-]+/g);
        return terms ? terms.map(term => term.trim()) : [];
      }

      // Integrate a single term (basic polynomial and sin, cos)
      function integrateTerm(term) {
        if (term.includes('sin')) {
          // ∫sin(ax) dx = -1/a cos(ax)
          const match = term.match(/([+-]?\d*)sin\((\d*)x\)/) || term.match(/([+-]?\d*)sin\(x\)/);
          if (match) {
            let coeff = parseFloat(match[1]);
            if (isNaN(coeff) || match[1] === '' || match[1] === '+') coeff = 1;
            if (match[1] === '-') coeff = -1;
            let a = 1;
            if (match[2]) {
              a = parseFloat(match[2]);
              if (isNaN(a) || a === 0) a = 1;
            }
            return `${-coeff / a}cos(${a === 1 ? 'x' : a + 'x'})`;
          }
        } else if (term.includes('cos')) {
          // ∫cos(ax) dx = 1/a sin(ax)
          const match = term.match(/([+-]?\d*)cos\((\d*)x\)/) || term.match(/([+-]?\d*)cos\(x\)/);
          if (match) {
            let coeff = parseFloat(match[1]);
            if (isNaN(coeff) || match[1] === '' || match[1] === '+') coeff = 1;
            if (match[1] === '-') coeff = -1;
            let a = 1;
            if (match[2]) {
              a = parseFloat(match[2]);
              if (isNaN(a) || a === 0) a = 1;
            }
            return `${coeff / a}sin(${a === 1 ? 'x' : a + 'x'})`;
          }
        } else {
          // Polynomial term ax^n or ax
          const match = term.match(/([+-]?\d*\.?\d*)x\^?(\d*)/);
          if (match) {
            let a = parseFloat(match[1]);
            if (isNaN(a) || match[1] === '' || match[1] === '+') a = 1;
            if (match[1] === '-') a = -1;
            let n = match[2] === '' ? 1 : parseInt(match[2]);
            if (isNaN(n)) n = 1;
            const newExp = n + 1;
            const newCoeff = a / newExp;
            return `${newCoeff.toFixed(4)}x^${newExp}`;
          } else {
            // Constant term
            const c = parseFloat(term);
            if (!isNaN(c)) {
              return `${c}x`;
            }
          }
        }
        return 'Unsupported term';
      }

      // Differentiate a single term (basic polynomial and sin, cos)
      function differentiateTerm(term) {
        if (term.includes('sin')) {
          // d/dx sin(ax) = a cos(ax)
          const match = term.match(/([+-]?\d*)sin\((\d*)x\)/) || term.match(/([+-]?\d*)sin\(x\)/);
          if (match) {
            let coeff = parseFloat(match[1]);
            if (isNaN(coeff) || match[1] === '' || match[1] === '+') coeff = 1;
            if (match[1] === '-') coeff = -1;
            let a = 1;
            if (match[2]) {
              a = parseFloat(match[2]);
              if (isNaN(a) || a === 0) a = 1;
            }
            return `${coeff * a}cos(${a === 1 ? 'x' : a + 'x'})`;
          }
        } else if (term.includes('cos')) {
          // d/dx cos(ax) = -a sin(ax)
          const match = term.match(/([+-]?\d*)cos\((\d*)x\)/) || term.match(/([+-]?\d*)cos\(x\)/);
          if (match) {
            let coeff = parseFloat(match[1]);
            if (isNaN(coeff) || match[1] === '' || match[1] === '+') coeff = 1;
            if (match[1] === '-') coeff = -1;
            let a = 1;
            if (match[2]) {
              a = parseFloat(match[2]);
              if (isNaN(a) || a === 0) a = 1;
            }
            return `${-coeff * a}sin(${a === 1 ? 'x' : a + 'x'})`;
          }
        } else {
          // Polynomial term ax^n or ax
          const match = term.match(/([+-]?\d*\.?\d*)x\^?(\d*)/);
          if (match) {
            let a = parseFloat(match[1]);
            if (isNaN(a) || match[1] === '' || match[1] === '+') a = 1;
            if (match[1] === '-') a = -1;
            let n = match[2] === '' ? 1 : parseInt(match[2]);
            if (isNaN(n)) n = 1;
            const newExp = n - 1;
            const newCoeff = a * n;
            if (newExp === 0) {
              return `${newCoeff.toFixed(4)}`;
            } else if (newExp === 1) {
              return `${newCoeff.toFixed(4)}x`;
            } else {
              return `${newCoeff.toFixed(4)}x^${newExp}`;
            }
          } else {
            // Constant term derivative is 0
            const c = parseFloat(term);
            if (!isNaN(c)) {
              return '0';
            }
          }
        }
        return 'Unsupported term';
      }

      // Format term for display (remove +1x, fix signs)
      function formatTerm(term) {
        if (term === '0') return '';
        term = term.replace(/\+1x/g, '+x');
        term = term.replace(/-1x/g, '-x');
        term = term.replace(/^\+/, '');
        return term;
      }

      // Generate step-by-step integration or differentiation
      function generateSteps(funcStr, operation) {
        const terms = parseFunction(funcStr);
        const steps = [];
        terms.forEach(term => {
          let step;
          if (operation === 'integrate') {
            step = integrateTerm(term);
            steps.push(`∫${term} dx = ${formatTerm(step)} + C`);
          } else if (operation === 'differentiate') {
            step = differentiateTerm(term);
            steps.push(`d/dx(${term}) = ${formatTerm(step)}`);
          }
        });
        return steps;
      }

      // Handle form submission
      document.getElementById('calculationForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const funcStr = document.getElementById('functionInput').value;
        const operation = e.submitter.value; // integrate or differentiate
        const steps = generateSteps(funcStr, operation);
        const container = document.getElementById('stepsContainer');
        container.innerHTML = '';
        steps.forEach(step => {
          const p = document.createElement('p');
          p.textContent = step;
          container.appendChild(p);
        });
      });
    });
  </script>

  <script>
    // Set operations: union, intersection, cardinality
    function parseSet(input) {
      return input.split(',').map(s => s.trim()).filter(s => s !== '');
    }

    function union(setA, setB) {
      const result = new Set([...setA, ...setB]);
      return Array.from(result);
    }

    function intersection(setA, setB) {
      const setBSet = new Set(setB);
      return setA.filter(x => setBSet.has(x));
    }

    function cardinality(set) {
      return set.length;
    }

    document.getElementById('unionBtn').addEventListener('click', () => {
      const setA = parseSet(document.getElementById('setA').value);
      const setB = parseSet(document.getElementById('setB').value);
      const result = union(setA, setB);
      document.getElementById('setResult').textContent = `Union: { ${result.join(', ')} }`;
    });

    document.getElementById('intersectionBtn').addEventListener('click', () => {
      const setA = parseSet(document.getElementById('setA').value);
      const setB = parseSet(document.getElementById('setB').value);
      const result = intersection(setA, setB);
      document.getElementById('setResult').textContent = `Intersection: { ${result.join(', ')} }`;
    });

    document.getElementById('cardinalityBtn').addEventListener('click', () => {
      const setA = parseSet(document.getElementById('setA').value);
      const setB = parseSet(document.getElementById('setB').value);
      const cardA = cardinality(setA);
      const cardB = cardinality(setB);
      document.getElementById('setResult').textContent = `Cardinality:\n|A| = ${cardA}\n|B| = ${cardB}`;
    });

    // Permutations and Combinations
    function factorial(n) {
      if (n < 0) return NaN;
      if (n === 0 || n === 1) return 1;
      let result = 1;
      for (let i = 2; i <= n; i++) {
        result *= i;
      }
      return result;
    }

    function permutations(n, r) {
      if (r > n) return 0;
      return factorial(n) / factorial(n - r);
    }

    function combinations(n, r) {
      if (r > n) return 0;
      return factorial(n) / (factorial(r) * factorial(n - r));
    }

    document.getElementById('permutationBtn').addEventListener('click', () => {
      const n = parseInt(document.getElementById('nValue').value);
      const r = parseInt(document.getElementById('rValue').value);
      if (isNaN(n) || isNaN(r) || n < 0 || r < 0) {
        document.getElementById('permCombResult').textContent = 'Please enter valid non-negative integers for n and r.';
        return;
      }
      const result = permutations(n, r);
      document.getElementById('permCombResult').textContent = `Permutations P(${n}, ${r}) = ${result}`;
    });

    document.getElementById('combinationBtn').addEventListener('click', () => {
      const n = parseInt(document.getElementById('nValue').value);
      const r = parseInt(document.getElementById('rValue').value);
      if (isNaN(n) || isNaN(r) || n < 0 || r < 0) {
        document.getElementById('permCombResult').textContent = 'Please enter valid non-negative integers for n and r.';
        return;
      }
      const result = combinations(n, r);
      document.getElementById('permCombResult').textContent = `Combinations C(${n}, ${r}) = ${result}`;
    });

    // Probability Basics: Calculate P(A ∪ B)
    document.getElementById('calcProbBtn').addEventListener('click', () => {
      const pA = parseFloat(document.getElementById('probEventA').value);
      const pB = parseFloat(document.getElementById('probEventB').value);
      const pAB = parseFloat(document.getElementById('probEventAB').value);
      if (
        isNaN(pA) || isNaN(pB) || isNaN(pAB) ||
        pA < 0 || pA > 1 || pB < 0 || pB > 1 || pAB < 0 || pAB > 1
      ) {
        document.getElementById('probResult').textContent = 'Please enter valid probabilities between 0 and 1.';
        return;
      }
      // P(A ∪ B) = P(A) + P(B) - P(A ∩ B)
      const pUnion = pA + pB - pAB;
      document.getElementById('probResult').textContent = `P(A ∪ B) = ${pUnion.toFixed(4)}`;
    });

    // Averages: Mean, Median, Mode
    document.getElementById('calcAvgBtn').addEventListener('click', () => {
      const dataStr = document.getElementById('dataSet').value;
      if (!dataStr) {
        document.getElementById('avgResult').textContent = 'Please enter a data set.';
        return;
      }
      const data = dataStr.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
      if (data.length === 0) {
        document.getElementById('avgResult').textContent = 'Please enter valid numbers in the data set.';
        return;
      }
      // Mean
      const mean = data.reduce((a, b) => a + b, 0) / data.length;
      // Median
      const sorted = [...data].sort((a, b) => a - b);
      let median;
      const mid = Math.floor(sorted.length / 2);
      if (sorted.length % 2 === 0) {
        median = (sorted[mid - 1] + sorted[mid]) / 2;
      } else {
        median = sorted[mid];
      }
      // Mode
      const freqMap = {};
      let maxFreq = 0;
      let mode = [];
      sorted.forEach(num => {
        freqMap[num] = (freqMap[num] || 0) + 1;
        if (freqMap[num] > maxFreq) {
          maxFreq = freqMap[num];
        }
      });
      for (const num in freqMap) {
        if (freqMap[num] === maxFreq) {
          mode.push(Number(num));
        }
      }
      if (mode.length === sorted.length) {
        mode = ['No mode'];
      }
      document.getElementById('avgResult').textContent =
        `Mean: ${mean.toFixed(4)}\nMedian: ${median.toFixed(4)}\nMode: ${mode.join(', ')}`;
    });

    // Dispersion: Variance and Standard Deviation
    document.getElementById('calcDispersionBtn').addEventListener('click', () => {
      const dataStr = document.getElementById('dataSet').value;
      if (!dataStr) {
        document.getElementById('dispersionResult').textContent = 'Please enter a data set.';
        return;
      }
      const data = dataStr.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
      if (data.length === 0) {
        document.getElementById('dispersionResult').textContent = 'Please enter valid numbers in the data set.';
        return;
      }
      const mean = data.reduce((a, b) => a + b, 0) / data.length;
      const variance = data.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / data.length;
      const stdDev = Math.sqrt(variance);
      document.getElementById('dispersionResult').textContent =
        `Variance: ${variance.toFixed(4)}\nStandard Deviation: ${stdDev.toFixed(4)}`;
    });

    // Coordinate Geometry functionalities

    // Calculate distance from origin
    document.getElementById('calcDistanceBtn').addEventListener('click', () => {
      const x = parseFloat(document.getElementById('pointX').value);
      const y = parseFloat(document.getElementById('pointY').value);
      if (isNaN(x) || isNaN(y)) {
        document.getElementById('distanceResult').textContent = 'Please enter valid numbers for X and Y.';
        return;
      }
      const distance = Math.sqrt(x * x + y * y);
      document.getElementById('distanceResult').textContent = `Distance from origin: ${distance.toFixed(4)}`;
    });

    // Calculate line equation given two points
    document.getElementById('calcLineBtn').addEventListener('click', () => {
      const x1 = parseFloat(document.getElementById('lineX1').value);
      const y1 = parseFloat(document.getElementById('lineY1').value);
      const x2 = parseFloat(document.getElementById('lineX2').value);
      const y2 = parseFloat(document.getElementById('lineY2').value);
      if ([x1, y1, x2, y2].some(v => isNaN(v))) {
        document.getElementById('lineResult').textContent = 'Please enter valid numbers for all points.';
        return;
      }
      if (x1 === x2) {
        document.getElementById('lineResult').textContent = `Line equation: x = ${x1.toFixed(4)}`;
        return;
      }
      const slope = (y2 - y1) / (x2 - x1);
      const intercept = y1 - slope * x1;
      document.getElementById('lineResult').textContent = `Line equation: y = ${slope.toFixed(4)}x + ${intercept.toFixed(4)}`;
    });

    // Calculate circle equation given center and radius
    document.getElementById('calcCircleBtn').addEventListener('click', () => {
      const h = parseFloat(document.getElementById('circleH').value);
      const k = parseFloat(document.getElementById('circleK').value);
      const r = parseFloat(document.getElementById('circleR').value);
      if ([h, k, r].some(v => isNaN(v)) || r < 0) {
        document.getElementById('circleResult').textContent = 'Please enter valid numbers for center and radius (radius >= 0).';
        return;
      }
      document.getElementById('circleResult').textContent = `Circle equation: (x - ${h.toFixed(4)})² + (y - ${k.toFixed(4)})² = ${r.toFixed(4)}²`;
    });

    // Calculate parabola equation given vertex form parameters
    document.getElementById('calcParabolaBtn').addEventListener('click', () => {
      const a = parseFloat(document.getElementById('parabolaA').value);
      const h = parseFloat(document.getElementById('parabolaH').value);
      const k = parseFloat(document.getElementById('parabolaK').value);
      if ([a, h, k].some(v => isNaN(v)) || a === 0) {
        document.getElementById('parabolaResult').textContent = 'Please enter valid numbers for a (non-zero), h, and k.';
        return;
      }
      document.getElementById('parabolaResult').textContent = `Parabola equation: y = ${a.toFixed(4)}(x - ${h.toFixed(4)})² + ${k.toFixed(4)}`;
    });

    // Calculate ellipse equation given center and axes
    document.getElementById('calcEllipseBtn').addEventListener('click', () => {
      const h = parseFloat(document.getElementById('ellipseH').value);
      const k = parseFloat(document.getElementById('ellipseK').value);
      const a = parseFloat(document.getElementById('ellipseA').value);
      const b = parseFloat(document.getElementById('ellipseB').value);
      if ([h, k, a, b].some(v => isNaN(v)) || a <= 0 || b <= 0) {
        document.getElementById('ellipseResult').textContent = 'Please enter valid numbers for center and positive axes a and b.';
        return;
      }
      document.getElementById('ellipseResult').textContent = `Ellipse equation: ((x - ${h.toFixed(4)})² / ${a.toFixed(4)}²) + ((y - ${k.toFixed(4)})² / ${b.toFixed(4)}²) = 1`;
    });

    // Calculate hyperbola equation given center and axes
    document.getElementById('calcHyperbolaBtn').addEventListener('click', () => {
      const h = parseFloat(document.getElementById('hyperbolaH').value);
      const k = parseFloat(document.getElementById('hyperbolaK').value);
      const a = parseFloat(document.getElementById('hyperbolaA').value);
      const b = parseFloat(document.getElementById('hyperbolaB').value);
      if ([h, k, a, b].some(v => isNaN(v)) || a <= 0 || b <= 0) {
        document.getElementById('hyperbolaResult').textContent = 'Please enter valid numbers for center and positive axes a and b.';
        return;
      }
      document.getElementById('hyperbolaResult').textContent = `Hyperbola equation: ((x - ${h.toFixed(4)})² / ${a.toFixed(4)}²) - ((y - ${k.toFixed(4)})² / ${b.toFixed(4)}²) = 1`;
    });

    // Advanced Calculus functionalities

    // Calculate limit of function as x approaches a value (basic numeric approach)
    document.getElementById('calcLimitBtn').addEventListener('click', () => {
      const expr = document.getElementById('limitExpr').value;
      const xVal = parseFloat(document.getElementById('limitAt').value);
      if (!expr || isNaN(xVal)) {
        document.getElementById('limitResult').textContent = 'Please enter a valid function and limit value.';
        return;
      }
      try {
        // Use numeric approach: evaluate f(x) at values approaching xVal from left and right
        const f = new Function('x', `return ${expr};`);
        const left = f(xVal - 1e-7);
        const right = f(xVal + 1e-7);
        if (Math.abs(left - right) < 1e-5) {
          document.getElementById('limitResult').textContent = `Limit as x approaches ${xVal} is approximately ${left.toFixed(6)}`;
        } else {
          document.getElementById('limitResult').textContent = `Limit does not exist (left: ${left}, right: ${right})`;
        }
      } catch (e) {
        document.getElementById('limitResult').textContent = 'Error evaluating function. Please enter a valid expression.';
      }
    });

    // Calculate tangent and normal lines at a point
    document.getElementById('calcTangentBtn').addEventListener('click', () => {
      const expr = document.getElementById('tangentExpr').value;
      const xVal = parseFloat(document.getElementById('tangentAt').value);
      if (!expr || isNaN(xVal)) {
        document.getElementById('tangentResult').textContent = 'Please enter a valid function and x value.';
        return;
      }
      try {
        const f = new Function('x', `return ${expr};`);
        const h = 1e-7;
        const slope = (f(xVal + h) - f(xVal - h)) / (2 * h);
        const yVal = f(xVal);
        const tangent = `y = ${slope.toFixed(4)}(x - ${xVal.toFixed(4)}) + ${yVal.toFixed(4)}`;
        const normalSlope = slope === 0 ? 'undefined' : (-1 / slope).toFixed(4);
        const normal = normalSlope === 'undefined' ? 'Normal line is vertical (undefined slope)' : `y = ${normalSlope}(x - ${xVal.toFixed(4)}) + ${yVal.toFixed(4)}`;
        document.getElementById('tangentResult').textContent = `Tangent line: ${tangent}\nNormal line: ${normal}`;
      } catch (e) {
        document.getElementById('tangentResult').textContent = 'Error evaluating function. Please enter a valid expression.';
      }
    });

    // Calculate maxima and minima using numeric derivative approach
    document.getElementById('calcMaxMinBtn').addEventListener('click', () => {
      const expr = document.getElementById('maxMinExpr').value;
      if (!expr) {
        document.getElementById('maxMinResult').textContent = 'Please enter a valid function.';
        return;
      }
      try {
        const f = new Function('x', `return ${expr};`);
        const df = (x) => {
          const h = 1e-7;
          return (f(x + h) - f(x - h)) / (2 * h);
        };
        const ddf = (x) => {
          const h = 1e-7;
          return (df(x + h) - df(x - h)) / (2 * h);
        };
        // Search for critical points in range -10 to 10 with step 0.1
        const criticalPoints = [];
        for (let x = -10; x <= 10; x += 0.1) {
          if (Math.abs(df(x)) < 1e-4) {
            criticalPoints.push(x);
          }
        }
        if (criticalPoints.length === 0) {
          document.getElementById('maxMinResult').textContent = 'No critical points found in range -10 to 10.';
          return;
        }
        let results = '';
        criticalPoints.forEach(x => {
          const concavity = ddf(x);
          const y = f(x);
          if (concavity > 0) {
            results += `Local minimum at x = ${x.toFixed(4)}, y = ${y.toFixed(4)}\n`;
          } else if (concavity < 0) {
            results += `Local maximum at x = ${x.toFixed(4)}, y = ${y.toFixed(4)}\n`;
          } else {
            results += `Inflection point at x = ${x.toFixed(4)}, y = ${y.toFixed(4)}\n`;
          }
        });
        document.getElementById('maxMinResult').textContent = results.trim();
      } catch (e) {
        document.getElementById('maxMinResult').textContent = 'Error evaluating function. Please enter a valid expression.';
      }
    });

    // Calculate definite integral using trapezoidal rule
    document.getElementById('calcDefIntegralBtn').addEventListener('click', () => {
      const expr = document.getElementById('defIntegralExpr').value;
      const a = parseFloat(document.getElementById('defIntegralA').value);
      const b = parseFloat(document.getElementById('defIntegralB').value);
      if (!expr || isNaN(a) || isNaN(b) || a > b) {
        document.getElementById('defIntegralResult').textContent = 'Please enter a valid function and limits (a <= b).';
        return;
      }
      try {
        const f = new Function('x', `return ${expr};`);
        const n = 1000; // number of trapezoids
        const h = (b - a) / n;
        let sum = 0.5 * (f(a) + f(b));
        for (let i = 1; i < n; i++) {
          sum += f(a + i * h);
        }
        const integral = sum * h;
        document.getElementById('defIntegralResult').textContent = `Definite integral from ${a} to ${b} is approximately ${integral.toFixed(6)}`;
      } catch (e) {
        document.getElementById('defIntegralResult').textContent = 'Error evaluating function. Please enter a valid expression.';
      }
    });
  </script>
</body>
</html>
